<!doctype html>
<html lang="<%= lng || 'ja' %>">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= t('checkout.done_title') %></title>
  <link rel="stylesheet" href="/public/style.css?v=<%= assetVer %>" />
  <style>
    .lang-select{ margin-left:12px }
    .lang-select__control{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      background:#0f172a; border:1px solid #243246; color:#fff;
      padding:.55rem .9rem; border-radius:12px; font-weight:700;
    }
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>

<body class="layout">

<header class="nav">
  <a class="nav__brand" href="/">
    <img class="nav__logo" src="/public/logo.png" alt="Instant Sale" width="28" height="28" />
    <span class="nav__brandText"><%= t('brand') %></span>
  </a>
  <nav class="nav__right">
    <% if (me) { %>
      <span class="nav__user"><%= me.name || me.email %></span>
      <form method="post" action="/logout" class="inline">
        <button class="btn btn--ghost"><%= t('nav.logout') %></button>
      </form>
    <% } else { %>
      <a class="btn btn--ghost" href="/auth/google"><%= t('nav.login_google') %></a>
    <% } %>

<form class="lang-select" action="/lang" method="get" aria-label="Language">
  <input type="hidden" name="return" value="<%= currentPath %>">
  <label for="langSelect" class="sr-only">Language</label>
  <select id="langSelect" name="lng" class="lang-select__control">
    <option value="ja" <%= lng==='ja' ? 'selected' : '' %>>日本語</option>
    <option value="en" <%= lng==='en' ? 'selected' : '' %>>English</option>
  </select>
  <noscript><button class="btn btn--ghost" type="submit">OK</button></noscript>
</form>

  </nav>
 
</header>

<% const locale = (lng === 'en' ? 'en-US' : 'ja-JP'); %>

<main class="container">
  <div class="card success">
    <h1><%= t('checkout.done_title') %></h1>
    <p><%= t('checkout.done_desc') %></p>

<p>
  <%- t('checkout.expire_note_html', { minutes: ttlMin, time: expiresAt.toLocaleString(locale) }) %>
</p>

    <p>
      <a class="btn primary" href="<%= downloadUrl %>"><%= t('checkout.download_btn') %></a>
    </p>
  </div>
</main>

<%- include('partials/footer') %>

<script nonce="<%= cspNonce %>">
  (function(){
    var sel = document.getElementById('langSelect');
    if(!sel) return;
    sel.addEventListener('change', function(){ try{ sel.form.submit(); }catch(_){} });
  })();
</script>

</body>
</html>
