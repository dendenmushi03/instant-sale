<!doctype html>
<html lang="<%= lng || 'ja' %>">
<head>
  <%- include('../partials/head', { title: (t('tokushoho.title') || '特定商取引法に基づく表記') + ' | ' + t('brand') }) %>
</head>

<body class="layout">
  <%- include('../partials/header') %>

  <%
    // ---- フォールバック文言（未設定時の置き換え） ----
    const has = (v) => v && String(v).trim().length > 0;

    const nameDisp = has(sellerName)
      ? sellerName
      : (t('tokushoho.fallback.name') || '個人で運営しているため、氏名（又は屋号＋代表者名）はご請求いただいた場合に遅滞なく開示します。');

    const respDisp = has(responsibleName) ? responsibleName : '—';

    const addressDisp = has(address)
      ? address
      : (t('tokushoho.fallback.address') || '個人で運営しているため、住所はご請求いただいた場合に遅滞なく開示します。');

    const phoneDisp = has(phone)
      ? phone
      : (t('tokushoho.fallback.phone') || '電話番号はご請求があれば遅滞なく開示いたします（通常のお問い合わせはメールでお願いします）。');

    const websiteDisp = has(website) ? website : '';
    const hoursDisp = has(businessHours) ? businessHours : (t('tokushoho.fallback.hours') || '平日 10:00-18:00');

    // 表示用のサポート連絡先
    const supportMail = email || 'Instant-Sale.sup@outlook.jp';
  %>

  <main class="container legal">
    <h1><%= t('tokushoho.h1') || '特定商取引法に基づく表記' %></h1>

    <table class="legal-table">
      <tr><th><%= t('tokushoho.label.seller') || '販売事業者' %></th><td><%= nameDisp %></td></tr>
      <tr><th><%= t('tokushoho.label.responsible') || '運営責任者' %></th><td><%= respDisp %></td></tr>
      <tr><th><%= t('tokushoho.label.address') || '所在地' %></th><td><%= addressDisp %></td></tr>

      <tr>
        <th><%= t('tokushoho.label.contact') || '連絡先' %></th>
        <td>
          <% 
            // t() が未定義キーの場合はキー文字列を返すケースに備えた安全ラベル
            const tSafe = (key, ja, en) => {
              const v = t(key);
              if (!v || v === key) return (lng === 'en' ? (en || ja) : ja);
              return v;
            };
            const phoneLabel = tSafe('tokushoho.label.phone', '電話番号', 'Phone');
            const emailLabel = tSafe('tokushoho.label.email', 'メール', 'Email');
          %>
          <% if (has(phone)) { %>
            <%= phoneLabel %>: <%= phoneDisp %><br>
          <% } else { %>
            <%= phoneDisp %><br>
          <% } %>
          <%= emailLabel %>: <a href="mailto:<%= email %>"><%= email %></a>
        </td>
      </tr>

      <tr>
        <th><%= t('tokushoho.label.website') || 'ウェブサイト' %></th>
        <td>
          <% if (websiteDisp) { %>
            <a href="<%= websiteDisp %>" target="_blank" rel="noopener"><%= websiteDisp %></a>
          <% } else { %>
            —
          <% } %>
        </td>
      </tr>

      <tr><th><%= t('tokushoho.label.price') || '販売価格' %></th><td><%= t('tokushoho.value.price') || '各商品ページに表示' %></td></tr>

      <tr>
        <th><%= t('tokushoho.label.otherFees') || '商品代金以外の必要料金' %></th>
        <td>
          <%= t('tokushoho.value.otherFees_prefix') || 'プラットフォーム手数料やStripe決済手数料が発生する場合があります。' %><br>
          <%= t('tokushoho.value.otherFees_seller_prefix') || '出品者向け：' %>
          <strong><%= t('tokushoho.value.platform_fee', { pct: (typeof platformFeePct !== 'undefined' ? platformFeePct : 20) }) || `プラットフォーム手数料：販売価格（税込）の ${(typeof platformFeePct !== 'undefined' ? platformFeePct : 20)}％` %></strong>
        </td>
      </tr>

      <tr><th><%= t('tokushoho.label.paymentMethod') || 'お支払い方法' %></th><td><%= t('tokushoho.value.paymentMethod') || 'Stripeによるクレジットカード等' %></td></tr>
      <tr><th><%= t('tokushoho.label.paymentTiming') || 'お支払い時期' %></th><td><%= t('tokushoho.value.paymentTiming') || '購入時に即時決済（お支払い方法により異なる場合があります）' %></td></tr>
      <tr><th><%= t('tokushoho.label.delivery') || '引き渡し時期' %></th><td><%= t('tokushoho.value.delivery') || '決済確認後、ただちにダウンロード可能なURLを発行' %></td></tr>
      <tr><th><%= t('tokushoho.label.refund') || '返品・キャンセル' %></th><td><%= t('tokushoho.value.refund') || 'デジタル商品のため返品不可。二重決済・誤課金・欠陥データ等は個別対応' %></td></tr>
      <tr><th><%= t('tokushoho.label.env') || '動作環境' %></th><td><%= t('tokushoho.value.env') || 'インターネット接続環境および一般的なWebブラウザ' %></td></tr>
      <tr><th><%= t('tokushoho.label.qty') || '販売数量の制限' %></th><td><%= t('tokushoho.value.qty') || '特に制限はありません（在庫・数量制限の記載がある商品を除く）' %></td></tr>
      <tr><th><%= t('tokushoho.label.hours') || '営業時間' %></th><td><%= hoursDisp %></td></tr>
      <tr><th><%= t('tokushoho.label.notes') || '備考' %></th><td><%= t('tokushoho.value.notes') || '特別な条件がある場合は各商品ページに記載します。' %></td></tr>

      <tr>
        <th><%= t('tokushoho.label.stripe') || 'Stripeに関する表示' %></th>
        <td>
          <%= t('tokushoho.value.stripe_html') || '当サービスはStripeを利用して決済を処理します。<br>カード情報は当サービスで保存しません。' %>
        </td>
      </tr>
    </table>

    <!-- ▼ 仲介方式の明示・販売者情報の開示請求（ページ直下に常時表示） -->
    <section class="legal-note" style="margin-top:20px">
      <h2 style="font-size:1.1rem;margin-bottom:.5rem;">販売形態（仲介方式）</h2>
      <p style="margin:0 0 .5rem 0;">
        Instant Sale は、ユーザーが自ら作成したデジタルコンテンツ（画像等）を販売するためのプラットフォームです。
        各商品は出品者によって提供され、当社は決済処理および販売仲介を行います。
      </p>
      <p style="margin:0 0 .5rem 0;">
        出品者が反復継続して販売を行う場合、特定商取引法上の「販売業者」に該当することがあります。
        当該出品者に関する氏名（又は屋号＋代表者名）・所在地・電話番号等の開示をご希望の場合は、
        <a href="mailto:<%= supportMail %>"><%= supportMail %></a>
        までご連絡ください。内容を確認のうえ、法令に基づき遅滞なく開示します。
      </p>
    </section>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>
