<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload | Instant Sale</title>
  <link rel="stylesheet" href="/public/style.css" />
</head>
<body class="layout">

<header class="nav">
  <a class="nav__brand" href="/">
    <img class="nav__logo" src="/public/logo.png" alt="Instant Sale" width="28" height="28" loading="eager" decoding="async" />
    <span class="nav__brandText">Instant Sale</span>
  </a>
  <nav class="nav__right">
    <% if (me) { %>
      <span class="nav__user"><%= me.name || me.email %></span>
      <form method="post" action="/logout" class="inline">
        <button class="btn btn--ghost">ログアウト</button>
      </form>
    <% } else { %>
      <a class="btn btn--ghost" href="/auth/google">Googleでログイン</a>
    <% } %>
  </nav>
</header>
  
  <main class="container">
    <h1>即販売リンクを作る</h1>

<% if (typeof connect !== 'undefined') { %>
  <div class="row" style="margin:12px 0;">
    <% if (!connect.hasAccount || !connect.payoutsEnabled) { %>

<!-- 注意喚起 -->
<div class="alert alert--error">
  <strong>受取設定が未完了です。</strong><br>
  売上を受け取るには、Stripe で振込口座の登録と本人確認を完了してください。
</div>

<!-- Stripe オンボーディングボタン -->
<a class="btn btn--primary" href="/connect/onboard">振込口座を登録（Stripe）</a>

      <% } else { %>

<div class="alert alert--success">
  振込口座の登録が完了しています。
</div>
        
    <% } %>
  </div>
<% } %>

    <form class="card" action="/upload" method="post" enctype="multipart/form-data">
      <label>タイトル
        <input type="text" name="title" placeholder="作品タイトル" required />
      </label>
      <div class="row">
        <label style="flex:1">価格（<%= (process.env.CURRENCY || 'jpy').toUpperCase() %>）
          <input type="number" name="price" min="1" step="1" value="500" required />
        </label>
        <label style="flex:1">通貨
          <input type="text" name="currency" value="<%= (process.env.CURRENCY || 'jpy') %>" />
        </label>
      </div>
      <label>クリエイター名（任意）
        <input type="text" name="creatorName" placeholder="表示用の名前（任意）" />
      </label>
      <label>画像（高解像度ファイル）
        <input type="file" name="image" accept="image/*" required />
      </label>
      <label>
  <input type="checkbox" name="attestOwner" required />
  私はこの画像の権利者（または正当に販売可能な権利保有者）です
</label>
      <button type="submit" class="btn primary">販売ページを作成</button>
    </form>

    <% if (typeof createdUrl !== 'undefined') { %>
      <div class="card success">
        <p>販売ページができました！</p>
        <p><a class="btn" href="<%= createdUrl %>" target="_blank"><%= createdUrl %></a></p>
        <p>このURLをX/Instagramに貼ると、OGP付きで見栄えよく表示されます。</p>
      </div>
    <% } %>
  </main>

<footer class="site-footer">
  <div class="footer__links">
    <a href="/terms">利用規約</a>
    <span class="dot">•</span>
    <a href="/privacy">プライバシーポリシー</a>
    <span class="dot">•</span>
    <a href="/tokushoho">特定商取引法に基づく表記</a>
  </div>
  <div class="footer__copy">© <%= new Date().getFullYear() %> Instant Sale</div>
</footer>
  
</body>
</html>
