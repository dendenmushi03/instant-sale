<!doctype html>
<html lang="<%= lng || 'ja' %>">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title><%= t('download.title', { title: item.title }) %></title>
  <link rel="stylesheet" href="/public/style.css?v=<%= assetVer %>">
  <style>
    .dlWrap{max-width:1024px;margin:0 auto;padding:16px}
    .dlNote{margin:12px 0 16px;padding:12px 14px;border-radius:12px;border:1px solid #7f1d1d;background:#2b0e12;color:#fecaca;line-height:1.7}
    .dlNote strong{font-weight:800}
    .dlImage{display:block;width:100%;height:auto;border-radius:12px;border:1px solid var(--border,#223);background:#0f1115}
    .dlMeta{color:#a9c0e6;font-size:13px;margin-top:8px}
  </style>

    .lang-select{ margin-left:12px }
    .lang-select__control{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      background:#0f172a; border:1px solid #243246; color:#fff;
      padding:.55rem .9rem; border-radius:12px; font-weight:700;
    }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>

</head>
<body class="layout">

<header class="nav">
  <a class="nav__brand" href="/">
    <img class="nav__logo" src="/public/logo.png" alt="Instant Sale" width="28" height="28">
    <span class="nav__brandText"><%= t('brand') %></span>
  </a>
  <nav class="nav__right">
    <% if (me) { %>
      <span class="nav__user"><%= me.name || me.email %></span>
      <form method="post" action="/logout" class="inline">
        <button class="btn btn--ghost"><%= t('nav.logout') %></button>
      </form>
    <% } else { %>
      <a class="btn btn--ghost" href="/auth/google"><%= t('nav.login_google') %></a>
    <% } %>

  <!-- 言語セレクタ（ドロップダウン） -->
  <form class="lang-select" action="/lang" method="get" aria-label="Language">
    <label for="langSelect" class="sr-only">Language</label>
    <select id="langSelect" name="lng" class="lang-select__control">
      <option value="ja" <%= lng==='ja' ? 'selected' : '' %>>日本語</option>
      <option value="en" <%= lng==='en' ? 'selected' : '' %>>English</option>
    </select>
    <noscript><button class="btn btn--ghost" type="submit">OK</button></noscript>
  </form>

  </nav>
</header>

<% const locale = (lng === 'en' ? 'en-US' : 'ja-JP'); %>

<main class="dlWrap">
  <div class="dlNote" role="alert" aria-live="polite">
    <div style="font-weight:800;margin-bottom:4px;">

⚠ <%- t('download.notice_line1_html') %>

    </div>
    <strong><%= t('download.notice_line2') %></strong>
    （<%= t('download.expire_note', { minutes: ttlMin, time: expiresAt.toLocaleString(locale) }) %>）
  </div>

  <img class="dlImage" src="<%= imageUrl %>" alt="<%= t('download.img_alt', { title: item.title }) %>">
</main>

<%- include('partials/footer') %>

<script nonce="<%= cspNonce %>">
  (function(){
    var sel = document.getElementById('langSelect');
    if(!sel) return;
    sel.addEventListener('change', function(){ try{ sel.form.submit(); }catch(_){} });
  })();
</script>

</body>
</html>
